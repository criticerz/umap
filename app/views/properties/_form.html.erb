<%= form_for(@property) do |f| %>
  <% if @property.errors.any? %>
    <div id="error_explanation">
      <h2><%= pluralize(@property.errors.count, "error") %> prohibited this property from being saved:</h2>

      <ul>
      <% @property.errors.full_messages.each do |message| %>
        <li><%= message %></li>
      <% end %>
      </ul>
    </div>
  <% end %>

  <fieldset>
    
    <div class="form-group">
      <%= f.label :name %><br/>
      <%= f.text_field :name, class: 'form-control' %>
    </div>

    <div class="form-group">
      <label for="date_constructed">Date Constructed</label><br/>
      <select class="form-control" id="date_constructed" name="property[property_data][date_constructed]">
        <option value="">Select year..</option>
        <option value="Unknown"<%= ' selected' if @property.property_data.present? and @property.property_data['date_constructed'].present? and @property.property_data['date_constructed'] == 'Unknown' %>>Unknown</option>
        <% (1900..(Time.now.year)).each do |year| %>
          <option value="<%= year %>"<%= ' selected' if @property.property_data.present? and @property.property_data['date_constructed'].present? and @property.property_data['date_constructed'].to_i == year %>><%= year %></option>
        <% end %>
      </select>
    </div>

    <div class="form-group button-list checkbox-button-list" data-property-field="materials_used">
      <label for="date_constructed">Material Used</label><br/>

      <% material_options.each do |material| %>
        <button type="button" class="btn btn-default<%= ' active' if @property.property_data.present? and @property.property_data['materials_used'].present? and @property.property_data['materials_used'].include?(material) %>"><%= material %></button>
      <% end %>

      <% if @property.property_data.present? and @property.property_data['materials_used'].present? %>
        <% @property.property_data['materials_used'].each do |material| %>
          <input type="hidden" name="property[property_data][materials_used][]" value="<%= material %>" />
        <% end %>
      <% end %>

    </div>

    <div class="form-group button-list radio-button-list" data-property-field="number_of_inhabitants">
      <label for="date_constructed">Total # of inhabitants</label><br/>

      <% (0..20).each do |inhabitant_count| %>
        <button type="button" class="btn btn-default<%= ' active' if @property.property_data.present? and @property.property_data['number_of_inhabitants'].present? and @property.property_data['number_of_inhabitants'] != 'Unknown' && @property.property_data['number_of_inhabitants'].to_i == inhabitant_count %>"><%= inhabitant_count %></button>
      <% end %>

      <button type="button" class="btn btn-default<%= ' active' if @property.property_data.present? and @property.property_data['number_of_inhabitants'].present? and @property.property_data['number_of_inhabitants'] == 'Unknown' %>">Unknown</button>

      <% if @property.property_data.present? and @property.property_data['number_of_inhabitants'].present? %>
        <input type="hidden" name="property[property_data][number_of_inhabitants]" value="<%= @property.property_data['number_of_inhabitants'] %>" />
      <% end %>

    </div>

    <div class="form-group button-list radio-button-list" data-property-field="number_of_inhabitants_under_twelve">
      <label for="date_constructed"># of inhabitants under 12</label><br/>

      <% (0..20).each do |inhabitant_count| %>
        <button type="button" class="btn btn-default<%= ' active' if @property.property_data.present? and @property.property_data['number_of_inhabitants_under_twelve'].present? and @property.property_data['number_of_inhabitants_under_twelve'] != 'Unknown' && @property.property_data['number_of_inhabitants_under_twelve'].to_i == inhabitant_count %>"><%= inhabitant_count %></button>
      <% end %>

      <button type="button" class="btn btn-default<%= ' active' if @property.property_data.present? and @property.property_data['number_of_inhabitants_under_twelve'].present? and @property.property_data['number_of_inhabitants_under_twelve'] == 'Unknown' %>">Unknown</button>

      <% if @property.property_data.present? and @property.property_data['number_of_inhabitants_under_twelve'].present? %>
        <input type="hidden" name="property[property_data][number_of_inhabitants_under_twelve]" value="<%= @property.property_data['number_of_inhabitants_under_twelve'] %>" />
      <% end %>

    </div>

    <div class="form-group button-list radio-button-list" data-property-field="porch">
      <label for="date_constructed">Direction of Porch</label><br/>

      <% porch_options.each do |porch_option| %>
        <button type="button" class="btn btn-default<%= ' active' if @property.property_data.present? and @property.property_data['porch'].present? && @property.property_data['porch'] == porch_option %>"><%= porch_option %></button>
      <% end %>

      <% if @property.property_data.present? and @property.property_data['porch'].present? %>
        <input type="hidden" name="property[property_data][porch]" value="<%= @property.property_data['porch'] %>" />
      <% end %>

    </div>

    <div class="form-group button-list radio-button-list" data-property-field="windows">
      <label for="date_constructed">Has windows?</label><br/>

      <% window_options.each do |window_option| %>
        <button type="button" class="btn btn-default<%= ' active' if @property.property_data.present? and @property.property_data['windows'].present? && @property.property_data['windows'] == window_option %>"><%= window_option %></button>
      <% end %>

      <% if @property.property_data.present? and @property.property_data['windows'].present? %>
        <input type="hidden" name="property[property_data][windows]" value="<%= @property.property_data['windows'] %>" />
      <% end %>

    </div>

  </fieldset>

  <div class="actions">

    <% if params[:action] == 'new' || params[:action] == 'create' %>
      <%= f.hidden_field :user_id, value: current_user.id %>
      <%= f.hidden_field :coordinate_lat, value: params[:lat] %>
      <%= f.hidden_field :coordinate_lng, value: params[:lng] %>
    <% end %>

    <%= f.submit :class => 'btn btn-success' %>
  </div>
<% end %>
